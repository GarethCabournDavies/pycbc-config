# ER8 Gating Files

## Gating files for ER8B [1126051217, 1127271617)

Production gating files for ER8B:

 * H1-gating_SNR300-1126051217-1220400.txt.gz
 * L1-gating_SNR300-1126051217-1220400.txt.gz

The segments that were used to generate the triggers were generated by running the command [get_segments.sh](https://github.com/samantha-usman/gating/blob/master/omicron/segments/get_segments.sh)

### H1-gating_SNR300-1126051217-1220400.txt.gz

Steps for generating the file:

 1. Make a ``log`` and ``triggers`` directory.
 1. Build a frame file cache by running [find_h1_frames.sh](https://github.com/samantha-usman/gating/blob/master/omicron/H1/find_h1_frames.sh).
 1. Run the DAG [omicron.dag](https://github.com/samantha-usman/gating/blob/master/omicron/H1/omicron.dag) which uses the submit file [omicron.sub](https://github.com/samantha-usman/gating/blob/master/omicron/H1/omicron.sub) and the configuration file [parameters_0.txt](https://github.com/samantha-usman/gating/blob/master/omicron/H1/parameters_0.txt).
 1. To make the gating files, run [make_gates.sh](https://github.com/samantha-usman/gating/blob/master/omicron/H1/make_gates.sh)

The ``make_gates.sh`` script reports times for which you requested omicron triggers, but no triggers were output. For the current files, these are:

 * [1126910311 ... 1126910326) which corresponds to a lock too short to analyze. See [lock #4](https://ldas-jobs.ligo-wa.caltech.edu/~detchar/summary/day/20150921/lock/segments)

### L1-gating_SNR300-1126051217-1220400.txt.gz

Steps for generating the file:

 1. Make a ``log`` and ``triggers`` directory.
 1. Build a frame file cache by running [find_l1_frames.sh](https://github.com/samantha-usman/gating/blob/master/omicron/L1/find_l1_frames.sh).
 1. Run the DAG [omicron.dag](https://github.com/samantha-usman/gating/blob/master/omicron/L1/omicron.dag) which uses the submit file [omicron.sub](https://github.com/samantha-usman/gating/blob/master/omicron/L1/omicron.sub) and the configuration file [parameters_0.txt](https://github.com/samantha-usman/gating/blob/master/omicron/L1/parameters_0.txt).
 1. To make the gating files, run [make_gates.sh](https://github.com/samantha-usman/gating/blob/master/omicron/L1/make_gates.sh)

The ``make_gates.sh`` script reports times for which you requested omicron triggers, but no triggers were output. For the current files, these are:

 * [1126414893 ... 1126414951) lock too short to analyze [lock #1](https://ldas-jobs.ligo-la.caltech.edu/~detchar/summary/day/20150916/lock/segments/)
 * [1126555035 ... 1126555044) lock too short to analyze [lock #1](https://ldas-jobs.ligo-la.caltech.edu/~detchar/summary/day/20150917/lock/segments/)
 * [1126733175 ... 1126733223) lock too short to analyze [lock #5](https://ldas-jobs.ligo-la.caltech.edu/~detchar/summary/day/20150919/lock/segments/)
 * [1126771360 ... 1126771418) lock-loss bleeding into last omicron segment caused error message ``Otile::SaveTriggers: number of tiles above SNR threshold = 1002105 > 1000000 (L1:GDS-CALIB_STRAIN) --> do not save segment 1126771360.00000-1126771418.00000``. These data have been CAT1 vetoed for the C00 run. A new CAT1 flag just containing the lock-loss time will be made for the C01 run and omicron re-run.


## Gating files for ER8A Chunk 2

Test gating files for ER8A. Made using omicron and [https://github.com/samantha-usman/gating/blob/master/make_gating_from_omicron]

* H1-gating_SNR300-1125217722-574295.txt.gz
* L1-gating_SNR300-1125217722-574295.txt.gz

### H1-gating_SNR300-1125217722-574295.txt.gz

```shell
ligolw_segment_query_dqsegdb --segment-url https://segments.ligo.org --query-segments --include-segments H1:DMT-ANALYSIS_READY:1 --exclude-segments H1:DCH-MISSING_H1_HOFT_C00:2 --gps-start-time 1123858817 --gps-end-time `lalapps_tconvert now` --output H1-SEGMENTS.xml
ligo_data_find --gps-start-time 1123858817 --gps-end-time `lalapps_tconvert now` --type H1_HOFT_C00 --lal-cache --observatory H --url-type file > cache.lcf
make_gating_from_omicron --start 1125217722 --end 1125792017 --ifo H1 --min-snr 300 --zeros 0.25 --pad 0.25 --cache-file omicron.lcf --verbose
```

```C++
// ------------------------------------------------------------------
// Omicron (v2r1) option file generated on Mon Sep 21 08:00:49 CDT 2015
// Configuration type = GW
// ------------------------------------------------------------------

DATA       FFL              /home/samantha.usman/aligo/er8/omicron/H1/frames.lcf
DATA       CHANNELS         H1:GDS-CALIB_STRAIN
DATA       SAMPLEFREQUENCY  8192

PARAMETER  CHUNKDURATION    544
PARAMETER  SEGMENTDURATION  64
PARAMETER  OVERLAPDURATION  4
PARAMETER  QRANGE           3.3166  100.0
PARAMETER  FREQUENCYRANGE   32  4096
PARAMETER  MISMATCHMAX      0.2
PARAMETER  SNRTHRESHOLD     5

OUTPUT     PRODUCTS         triggers
OUTPUT     VERBOSITY        0
OUTPUT     FORMAT           rootxml

// clustering is only applied to XML
PARAMETER  CLUSTERING       TIME


OUTPUT  DIRECTORY  /home/samantha.usman/aligo/er8/omicron/H1/triggers
```

### L1-gating_SNR300-1125217722-574295.txt.gz

```shell
ligolw_segment_query_dqsegdb --segment-url https://segments.ligo.org --query-segments --include-segments L1:DMT-ANALYSIS_READY:1 --exclude-segments L1:DCH-MISSING_L1_HOFT_C00:2 --gps-start-time 1123858817 --gps-end-time `lalapps_tconvert now` --output L1-SEGMENTS.xml
ligo_data_find --gps-start-time 1123858817 --gps-end-time `lalapps_tconvert now` --type L1_HOFT_C00 --lal-cache --observatory L --url-type file > frames.lcf
make_gating_from_omicron --start 1125217722 --end 1125792017 --ifo L1 --min-snr 300 --zeros 0.25 --pad 0.25 --cache-file omicron.lcf --verbose
```

```C++
// ------------------------------------------------------------------
// Omicron (v2r1) option file generated on Mon Sep 21 08:00:49 CDT 2015
// Configuration type = GW
// ------------------------------------------------------------------

DATA       FFL              /home/samantha.usman/aligo/er8/omicron/L1/frames.lcf
DATA       CHANNELS         L1:GDS-CALIB_STRAIN
DATA       SAMPLEFREQUENCY  8192

PARAMETER  CHUNKDURATION    544
PARAMETER  SEGMENTDURATION  64
PARAMETER  OVERLAPDURATION  4
PARAMETER  QRANGE           3.3166  100.0
PARAMETER  FREQUENCYRANGE   32  4096
PARAMETER  MISMATCHMAX      0.2
PARAMETER  SNRTHRESHOLD     5

OUTPUT     PRODUCTS         triggers
OUTPUT     VERBOSITY        0
OUTPUT     FORMAT           rootxml

// clustering is only applied to XML
PARAMETER  CLUSTERING       TIME

OUTPUT  DIRECTORY  /home/samantha.usman/aligo/er8/omicron/L1/triggers
```

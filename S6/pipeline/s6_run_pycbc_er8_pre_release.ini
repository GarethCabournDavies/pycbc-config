; This configuration file was designed as a rerun over the two weeks of the bigdog
; analysis with the more modern pycbc analysis code. 
;
; This file is entirely preconfigured and includes the gps start/end times.
; To run, use the pcybc_make_hdf_coinc workflow generator.
;
; This file should be valid for the PyCBC pre-release 1.1.2

[workflow]
; https://ldas-jobs.ligo.caltech.edu/~cbc/docs/pycbc/ahope/initialization.html
; provides details of how to set up an ahope configuration .ini file
; start-time = 967593543
; end-time = 968803287
h1-channel-name = H1:LDAS-STRAIN
l1-channel-name = L1:LDAS-STRAIN
file-retention-level = all_triggers

;[pegasus_profile]
;condor|accounting_group=ligo.dev.o1.cbc.bns_spin.pycbcoffline

[workflow-ifos]
; This is the list of ifos to analyse
h1 =
l1 =

[workflow-datafind]
; See https://ldas-jobs.ligo.caltech.edu/~cbc/docs/pycbc/ahope/datafind.html
datafind-method = AT_RUNTIME_SINGLE_FRAMES
datafind-h1-frame-type = H1_LDAS_C02_L2
datafind-l1-frame-type = L1_LDAS_C02_L2
datafind-check-segment-gaps = update_times
datafind-check-frames-exist = raise_error
datafind-check-segment-summary = no_test
; Set this to sepcify the datafind server. If this is not set the code will
; use the value in ${LIGO_DATAFIND_SERVER}
;datafind-ligo-datafind-server = ""

[workflow-segments]
; See https://ldas-jobs.ligo.caltech.edu/~cbc/docs/pycbc/ahope/segments.html
segments-method = ALL_SINGLE_IFO_TIME
segments-h1-science-name = H1:DMT-SCIENCE:4
segments-l1-science-name = L1:DMT-SCIENCE:4
segments-database-url = https://segdb.ligo.caltech.edu
segments-veto-definer-url = https://www.lsc-group.phys.uwm.edu/ligovirgo/cbc/public/segments/S6/H1L1V1-S6_CBC_LOWMASS_D_OFFLINE-961545543-0.xml
segments-minimum-segment-length = 2000
; What vetos to apply before even analyzing data
segments-science-veto = 1 
; What vetoes to apply when doing coincidence and background estimation.
segments-veto-groups =
; What veto groups forms the 'final' quoted analysis
segments-final-veto-group = 123H

[workflow-tmpltbank]
; See https://ldas-jobs.ligo.caltech.edu/~cbc/docs/pycbc/ahope/template_bank.html
tmpltbank-method=WORKFLOW_NO_IFO_VARIATION_NODATA

[workflow-splittable]
splittable-method = NOOP

[workflow-matchedfilter]
; See https://ldas-jobs.ligo.caltech.edu/~cbc/docs/pycbc/ahope/matched_filter.html
matchedfilter-method=WORKFLOW_INDEPENDENT_IFOS
min-analysis-segments = 11
max-analysis-segments = 11
output-type = hdf

[workflow-coincidence]
; See https://ldas-jobs.ligo.caltech.edu/~cbc/docs/pycbc/ahope/coincidence.html
parallelization-factor = 10
background-bins = Low:chirp:3.48 Middle:chirp:6.1 Upper:chirp:12

[executables]
; setup of condor universe and location of executables
inspiral          = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_inspiral
splittable = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_splitbank
segment_query = ${which:ligolw_segment_query}
segments_from_cats = ${which:ligolw_segments_from_cats}
llwadd = ${which:ligolw_add}
ligolw_combine_segments = ${which:ligolw_combine_segments}
bank2hdf = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_coinc_bank2hdf
hdfinjfind = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_coinc_hdfinjfind
coinc = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_coinc_findtrigs
statmap = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_coinc_statmap
statmap_inj = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_coinc_statmap_inj
plot_sensitivity = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_page_sensitivity
plot_foundmissed = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_page_foundmissed
plot_snrifar = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_page_snrifar
plot_singles = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_plot_singles_vs_params
page_foreground = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_page_foreground
page_injections = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_page_injtable
hdf_trigger_merge = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_coinc_mergetrigs
plot_snrchi = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_page_snrchi
plot_coinc_snrchi = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_page_coinc_snrchi
plot_segments = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_page_segments
page_segplot = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_page_segplot
page_segtable = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_page_segtable
results_page = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_make_html_page
calculate_psd = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_calculate_psd
plot_range = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_plot_range
plot_spectrum = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_plot_psd_file
plot_hist = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_plot_hist
foreground_censor = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_foreground_censor
page_ifar = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_page_ifar
strip_injections = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_strip_injections
combine_statmap = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_combine_statmap
distribute_background_bins = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_distribute_background_bins
tmpltbank = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_geom_nonspinbank
plot_bank = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_plot_bank_bins
page_vetotable = https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-software/raw/master/v1.1.3/x86_64/composer_xe_2015.0.090/pycbc_page_vetotable

[llwadd]
[datafind]
urltype=file

;[strip_injections]
;max-effective-chirp-distance=110

[segments_from_cats]

[ligolw_combine_segments]

[splittable]
; options for splittable job
random-sort =

[pegasus_profile-calculate_psd]
condor|request_cpus=10

[calculate_psd]
cores = 10

[tmpltbank]
pn-order = threePointFivePN
f0 = 40
f-low = 40 
f-upper = 2048
delta-f = 0.01
min-match = 0.97 
min-mass1 = 1.0 
min-mass2 = 1.0 
max-mass1 = 25 
max-mass2 = 25
max-total-mass = 25
psd-model = iLIGOModel

[calculate_psd&inspiral]
segment-length = 256
segment-start-pad = 64
segment-end-pad = 16
psd-estimation = median
psd-segment-length = 16
psd-segment-stride = 8
psd-inverse-length = 16
strain-high-pass = 30
pad-data = 8
sample-rate = 4096
low-frequency-cutoff = 40

[inspiral]
; inspiral analysis parameters -- added to all inspiral jobs
chisq-bins = 16
snr-threshold = 5.0
newsnr-threshold = 5.0
approximant = SPAtmplt
order = 7
cluster-method = window
cluster-window = 1.0
processing-scheme = mkl
filter-inj-only =
injection-window = 2
;keep-loudest-interval = 2
;keep-loudest-num = 100

[inspiral-h1&calculate_psd-h1]
; h1 specific inspiral parameters
channel-name = ${workflow|h1-channel-name}

[inspiral-l1&calculate_psd-l1]
; l1 specific inspiral parameters
channel-name = ${workflow|l1-channel-name}

[bank2hdf]
[trig2hdf]

[coinc]
strict-coinc-time =
coinc-threshold = 0.001

[page_ifar]
decimation-factor = 5000

[coinc-full]
decimation-factor = ${page_ifar|decimation-factor}
loudest-keep = 500
timeslide-interval=0.100

[coinc-injfull&coinc-fullinj]
timeslide-interval=${coinc-full|timeslide-interval}
loudest-keep-value = 8.7
cluster-window = 10.0

[coinc-injinj]

[pegasus_profile-statmap&pegasus_profile-statmap_inj]
condor|request_memory = 20GB

[statmap&statmap_inj]
veto-window = 0.100

[combine_statmap]
[statmap&statmap_inj&combine_statmap]
cluster-window = 10.0

[foreground_censor]
strict-coinc-time = 

[statmap_inj]
ranking-statistic-threshold=8.7

[hdfinjfind]
injection-window = 1.0

[page_foreground]
[plot_snrifar]

[plot_snrchi]
[plot_coinc_snrchi]
[plot_coinc_snrchi-inj]
[plot_coinc_snrchi-bkg]
background-front=
[plot_coinc_snrchi-inj&plot_coinc_snrchi-bkg&plot_snrchi]
newsnr-contours =  5 6 7 8 9 10

[plot_sensitivity]
; Sensitivity Plots
[ifar]
sig-type = ifar

[stat]
sig-type = stat
sig-bins = 7 7.5 8 8.5 9 9.5 10 10.5 11 11.5 12 12.5 13 13.5 14

[dists]
min-dist = 0
max-dist = 40 

[bins]
chirp = 0 1.74 4 6 8 11
total = 0 4 8 16 25

; Sensitivity vs IFAR
[plot_sensitivity-mchirp_bins&plot_sensitivity-all_mchirp&plot_sensitivity-summary]
bin-type =  mchirp 
bins = ${bins|chirp} 
dist-bins = 50
integration-method = pylal
sig-type = ${ifar|sig-type}
min-dist = ${dists|min-dist}
max-dist = ${dists|max-dist}

[plot_sensitivity-mchirp_binsvt&plot_sensitivity-all_mchirpvt&plot_sensitivity-summaryvt]
bin-type =  mchirp 
bins = ${bins|chirp} 
dist-bins = 50
integration-method = pylal
dist-type = vt
sig-type = ${ifar|sig-type}

[plot_sensitivity-mtotal_bins&plot_sensitivity-all_mtotal]
bin-type =  total_mass
bins = ${bins|total}
dist-bins = 50 
integration-method = pylal
sig-type = ${ifar|sig-type}
min-dist = ${dists|min-dist}
max-dist = ${dists|max-dist}

[plot_sensitivity-spin_bins&plot_sensitivity-all_spin]
bin-type =  spin
bins = -0.4 -0.2 0.2 0.4 
dist-bins = 50 
integration-method = pylal
sig-type = ${ifar|sig-type}
min-dist = ${dists|min-dist}
max-dist = ${dists|max-dist}

; Sensitivity vs SNR plots
[plot_sensitivity-mchirp_bins_stat&plot_sensitivity-all_mchirp_stat]
bin-type =  mchirp 
bins = ${bins|chirp} 
dist-bins = 50
integration-method = pylal
sig-bins = ${stat|sig-bins}
sig-type = ${stat|sig-type}
min-dist = ${dists|min-dist}
max-dist = ${dists|max-dist}

[plot_sensitivity-mtotal_bins_stat]
bin-type =  total_mass
bins = ${bins|total}
dist-bins = 50 
integration-method = pylal
sig-bins = ${stat|sig-bins}
sig-type = ${stat|sig-type}
min-dist = ${dists|min-dist}
max-dist = ${dists|max-dist}

[plot_sensitivity-spin_bins_stat]
bin-type =  spin
bins = -0.4 -0.2 0.2 0.4 
dist-bins = 50 
integration-method = pylal
sig-bins = ${stat|sig-bins}
sig-type = ${stat|sig-type}
min-dist = ${dists|min-dist}
max-dist = ${dists|max-dist}

[plot_foundmissed]
[plot_foundmissed-mchirp]
axis-type=mchirp
dynamic=
[plot_foundmissed-chirpdistmchirp]
axis-type=mchirp
dynamic=
distance-type=chirp_distance

[plot_foundmissed-time]
axis-type=time
dynamic=

[plot_hist]
[plot_hist-summ_snr]
x-var = snr
x-min = 6
x-max = 12

[plot_hist-summ_newsnr]
x-var = newsnr
x-min = 6
x-max = 10

[plot_foundmissed-mchirp_static&plot_foundmissed-all_mchirp_static]
axis-type=mchirp
log-distance=
[plot_foundmissed-chirpdistmchirp_static&plot_foundmissed-all_chirpdistmchirp_static]
axis-type=mchirp
distance-type=chirp_distance
log-distance=
[plot_foundmissed-time_static&plot_foundmissed-all_time_static]
axis-type=time
log-distance=

[plot_foundmissed-mchirp_static_grad&plot_foundmissed-all_mchirp_static_grad&plot_foundmissed-summary]
axis-type=mchirp
log-distance=
gradient-far=

[plot_foundmissed-mchirp_static_gradm&plot_foundmissed-all_mchirp_static_gradm&plot_foundmissed-summarym]
axis-type=mchirp
log-distance=
gradient-far=
missed-on-top=

[plot_foundmissed-chirpdistmchirp_static_grad&plot_foundmissed-all_chirpdistmchirp_static_grad]
axis-type=mchirp
distance-type=chirp_distance
log-distance=
gradient-far=
[plot_foundmissed-time_static_grad&plot_foundmissed-all_time_static_grad]
axis-type=time
log-distance=
gradient-far=

[plot_singles]
[plot_singles-mass1_mass2_density]
x-var = mass1
y-var = mass2
z-var = density

[plot_singles-mtotal_eta_density]
x-var = mtotal
y-var = eta
z-var = density

[plot_singles-mass1_mass2_newsnr]
x-var = mass1
y-var = mass2
z-var = max(newsnr)

[plot_singles-mtotal_eta_newsnr]
x-var = mtotal
y-var = eta
z-var = max(newsnr)

[plot_singles-mass1_mass2_snr]
x-var = mass1
y-var = mass2
z-var = max(snr)

[plot_singles-mtotal_eta_snr]
x-var = mtotal
y-var = eta
z-var = max(snr)

[hdf_trigger_merge]
[pegasus_profile-hdf_trigger_merge]
condor|request_memory = 10GB
pycbc|installed = False
hints|execution.site = local

[page_injections]
[plot_segments]

[plot_range]
mass1 = 1.4
mass2 = 1.4
approximant = SPAtmplt

[pegasus_profile-plot_spectrum]
condor|request_memory = 10GB
[plot_spectrum]

[results_page]
output-path=../../html
analysis-title="PyCBC Coincident Analysis, S6, test of v1.1.3"
analysis-subtitle=""


[pegasus_profile-inspiral]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-splittable]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-llwadd]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-bank2hdf]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-hdfinjfind]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-coinc]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-statmap]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-statmap_inj]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-plot_sensitivity]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-plot_foundmissed]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-plot_snrifar]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-plot_singles]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-page_foreground]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-page_injections]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-plot_snrchi]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-plot_coinc_snrchi]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-plot_segments]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-page_segplot]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-page_segtable]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-results_page]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-calculate_psd]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-plot_range]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-plot_spectrum]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-plot_hist]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-foreground_censor]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-page_ifar]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-plot_bank]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-page_vetotable]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-tmpltbank]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-strip_injections]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-combine_statmap]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-distribute_background_bins]
pycbc|installed = False
hints|execution.site = local


[pegasus_profile-distribute_background_bins]
pycbc|installed = False
hints|execution.site = local


